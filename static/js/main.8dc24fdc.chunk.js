(this.webpackJsonpantispoofing_frontend=this.webpackJsonpantispoofing_frontend||[]).push([[0],{31:function(e){e.exports=JSON.parse('{"webcam":{"bar":{"success_count":{"title":"Successful attempts: ","text":"{{success_count}} out of 5"},"face_score":{"target_face_text":"Target face","not_target_face_text":"Not target face - open the given image on another device"},"input_select":{"title":"Select input device: "},"mirror_toggle":{"title":"Mirror image: "}},"view":{"timer":{"title":"Time left: ","expired":"You didn\'t show the target face for too long"},"success":{"text":"In accordance with your successful attacks you will be given bonuses. Enter key to register your session: {{key}}","copy_button":"Copy to clipboard"}}}}')},32:function(e){e.exports=JSON.parse('{"webcam":{"bar":{"success_count":{"title":"\u0423\u0441\u043f\u0435\u0448\u043d\u044b\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438: ","text":"{{success_count}} \u0438\u0437 5"},"face_score":{"target_face_text":"\u0426\u0435\u043b\u0435\u0432\u043e\u0435 \u043b\u0438\u0446\u043e","not_target_face_text":"\u041d\u0435\u0446\u0435\u043b\u0435\u0432\u043e\u0435 \u043b\u0438\u0446\u043e - \u043e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438, \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435"},"input_select":{"title":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443: "},"mirror_toggle":{"title":"\u041f\u0435\u0440\u0435\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435: "}},"view":{"timer":{"title":"\u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u0432\u0440\u0435\u043c\u0435\u043d\u0438: ","expired":"\u0412\u044b \u0434\u043e\u043b\u0433\u043e \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u043b\u0438 \u0446\u0435\u043b\u0435\u0432\u043e\u0435 \u043b\u0438\u0446\u043e"},"success":{"text":"\u0412 \u0441\u043e\u043e\u0442\u0432\u0435\u0441\u0442\u0432\u0438\u0438 \u0441 \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u043c\u0438 \u0430\u0442\u0430\u043a\u0430\u043c\u0438 \u0432\u0430\u043c \u043d\u0430\u0447\u0438\u0441\u043b\u044f\u0442 \u0431\u043e\u043d\u0443\u0441\u044b. \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043b\u044e\u0447 \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0430\u0448\u0443 \u0441\u0435\u0441\u0441\u0438\u044e: {{key}}","copy_button":"\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440"}}}}')},38:function(e,t,c){},54:function(e,t,c){"use strict";c.r(t);var n=c(0),a=c.n(n),r=c(25),i=c.n(r),s=(c(38),c(19)),o=c(3),u=c(5),l=c.n(u),d=c(9),b=c(2),j=c(23),f=c(33),O=c(56),h=c(1),p=function(e){var t=Object(n.useState)(null),c=Object(b.a)(t,2),a=c[0],r=c[1],i=Object(n.useState)(null),s=Object(b.a)(i,2),o=s[0],u=s[1],p=Object(n.useState)(null),m=Object(b.a)(p,2),v=m[0],x=m[1],g=Object(n.useState)(!0),w=Object(b.a)(g,2),S=w[0],k=w[1],_=Object(n.useState)(0),y=Object(b.a)(_,2),I=y[0],C=y[1],T=Object(n.useState)(null),N=Object(b.a)(T,2),E=N[0],R=N[1],L=Object(n.useState)(null),D=Object(b.a)(L,2),P=D[0],U=D[1],J=Object(n.useState)(null),M=Object(b.a)(J,2),W=M[0],F=M[1],B=Object(n.useState)(0),H=Object(b.a)(B,2),V=H[0],Y=H[1],q=Object(n.useState)(null),z=Object(b.a)(q,2),A=z[0],G=z[1],K=Object(n.useState)(null),Q=Object(b.a)(K,2),X=Q[0],Z=Q[1],$=Object(n.useState)([]),ee=Object(b.a)($,2),te=(ee[0],ee[1]),ce=Object(n.useState)(!1),ne=Object(b.a)(ce,2),ae=(ne[0],ne[1],Object(n.useState)(!1)),re=Object(b.a)(ae,2),ie=re[0],se=re[1],oe=Object(n.useState)(""),ue=Object(b.a)(oe,2),le=(ue[0],ue[1],Object(n.useState)(null)),de=Object(b.a)(le,2),be=de[0],je=de[1],fe=Object(n.useRef)(null),Oe=Object(n.useRef)(null),he=Object(n.useRef)(null),pe=Object(n.useRef)(null),me=Object(n.useRef)(null),ve=Object(n.useRef)(null),xe=Object(O.a)("common"),ge=xe.t,we=(xe.i18n,function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a&&a.getTracks().forEach((function(e){return e.stop()})),e.t0=r,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:null!==v&&void 0!==v?v:void 0}},audio:!1});case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),Se=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=5;break}return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,u(t.filter((function(e){return"videoinput"===e.kind})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){A&&clearTimeout(A),console.log("drop timeout cleared"),G(window.setTimeout((function(){e.expiredCallback&&e.expiredCallback()}),6e4)),console.log("drop timeout set")};return Object(n.useEffect)((function(){Se(),ke()}),[]),Object(n.useEffect)((function(){we()}),[v]),Object(n.useEffect)((function(){var e;he.current.srcObject=a,null===(e=he.current)||void 0===e||e.play(),a&&(Z(new MediaRecorder(a,{mimeType:"video/webm"})),je(Date.now()))}),[a]),Object(n.useEffect)((function(){(V>=5||e.passed)&&(se(!0),e.callback&&e.callback())}),[V,e.passed]),Object(n.useEffect)((function(){null===X||void 0===X||X.addEventListener("dataavailable",(function(e){te((function(t){return[].concat(Object(f.a)(t),[e.data])})),console.log(e.data)})),null===X||void 0===X||X.start(1e3)}),[X]),Object(n.useEffect)((function(){ie&&e.uploadCallback&&e.uploadCallback()}),[ie]),Object(n.useEffect)((function(){var t=he.current,c=pe.current,n=c.getContext("2d"),a=ve.current.offsetWidth/t.videoWidth,r=function(){var e=me.current,c=e.getContext("2d"),n=600*(t.videoHeight/t.videoWidth);return e.width=600,e.height=n,c.drawImage(t,0,0,600,n),e.toDataURL("image/jpeg",1)};!function(){var e,r;c.width=t.videoWidth*a,c.height=t.videoHeight*a,(null===(e=fe.current)||void 0===e?void 0:e.checked)&&n.scale(-1,1),n.drawImage(t,(null===(r=fe.current)||void 0===r?void 0:r.checked)?-1*c.width:0,0,c.width,c.height)}(),function(){if(E){var e,t=c.width/600;n.strokeStyle=E.color,n.lineWidth=2,n.rect(E.left*t-((null===(e=fe.current)||void 0===e?void 0:e.checked)?c.width:0),E.top*t,(E.right-E.left)*t,(E.bottom-E.top)*t),n.stroke()}}();var i=function(){var t=Object(d.a)(l.a.mark((function t(){var c,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.submitImage({imageURL:r(),id:e.faceID,assignmentId:e.assignmentId,cameraSelected:null===o||void 0===o?void 0:o.find((function(e){return e.deviceId==v})),cameraList:o,passedTime:be?(Date.now()-be)/1e3:null});case 2:c=t.sent,e.expiredCallback&&c.stop&&!0===c.stop&&e.expiredCallback(),c.face_score<.7&&ke(),n=c.success,R(Object(j.a)(Object(j.a)({},c.bbox),{},{color:n?"green":"blue"})),F(c.face_score),U(c.spoofing),n&&Y((function(e){return e+1}));case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.submitImage&&I%15===0&&i();var s=setTimeout((function(){return C((function(e){return e+1}))}),100);return function(){return clearTimeout(s)}}),[I]),Object(h.jsxs)("div",{children:[Object(h.jsx)("video",{autoPlay:!0,className:"hidden",ref:he,muted:!0,playsInline:!0}),Object(h.jsxs)("div",{className:"grid grid-cols-2",children:[Object(h.jsx)("div",{ref:ve,className:"col-span-2 lg:col-span-1",children:Object(h.jsx)("canvas",{ref:pe})}),Object(h.jsx)("div",{className:"col-span-2 lg:col-span-1 w-50 p-6 bg-gray-100",children:Object(h.jsxs)("ul",{children:[Object(h.jsxs)("li",{children:[Object(h.jsx)("b",{children:ge("webcam.bar.success_count.title")}),ge("webcam.bar.success_count.text",{success_count:V})]}),Object(h.jsx)("li",{children:!W||W>.7?Object(h.jsxs)("b",{children:[" ",ge("webcam.bar.face_score.not_target_face_text")," "]}):Object(h.jsxs)("b",{children:[" ",ge("webcam.bar.face_score.target_face_text")," "]})}),Object(h.jsxs)("li",{children:[Object(h.jsx)("b",{children:"spoofing:"})," ",P]}),Object(h.jsx)("li",{children:Object(h.jsxs)("label",{children:[Object(h.jsx)("b",{children:ge("webcam.bar.input_select.title")}),Object(h.jsx)("br",{}),Object(h.jsx)("select",{ref:Oe,disabled:!0,onChange:function(e){return x(e.target.value)},children:null===o||void 0===o?void 0:o.map((function(e){return Object(h.jsxs)("option",{value:e.deviceId,children:[" ",e.label||"Camera ".concat(e.deviceId)," "]})}))})]})}),Object(h.jsx)("li",{children:Object(h.jsxs)("label",{className:"flex items-center",children:[Object(h.jsx)("b",{className:"pr-2 flex-col",children:ge("webcam.bar.mirror_toggle.title")}),Object(h.jsx)("input",{className:"flex-col",type:"checkbox",ref:fe,checked:S,onChange:function(e){k(e.target.checked)}})]})}),Object(h.jsx)("li",{children:e.children}),Object(h.jsx)("li",{children:Object(h.jsx)("button",{id:"successButton",className:"hidden",onClick:function(){return Y((function(e){return e+1}))},children:" Success button "})})]})})]}),Object(h.jsx)("canvas",{ref:me,className:"hidden"})]})},m=function(e){var t,c=Object(n.useState)(null!==(t=e.seconds)&&void 0!==t?t:120),a=Object(b.a)(c,2),r=a[0],i=a[1];return Object(n.useEffect)((function(){if(!(r<=0)){var t=setTimeout((function(){return i((function(e){return e-1}))}),1e3);return function(){return clearTimeout(t)}}e.callback&&e.callback()}),[r]),Object(h.jsxs)("div",{children:[Object(h.jsxs)("span",{children:[" ",Math.floor(r/60).toString().padStart(2,"0")," "]}),":",Object(h.jsxs)("span",{children:[" ",Math.floor(r%60).toString().padStart(2,"0")," "]})]})},v=function(){var e=Object(d.a)(l.a.mark((function e(t){var c,n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.imageURL.split(",")[1],e.abrupt("return",fetch("https://toloka.suricatvision.com:8443/predictions/biometric",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(JSON.stringify({image:r,id:t.id,assignmentId:t.assignmentId,camera_name:{deviceId:null===(c=t.cameraSelected)||void 0===c?void 0:c.deviceId,label:null===(n=t.cameraSelected)||void 0===n?void 0:n.label},camera_list:null===(a=t.cameraList)||void 0===a?void 0:a.map((function(e){return{deviceId:e.deviceId,label:e.label}})),passedTime:t.passedTime||null}))}).then((function(e){return e.json()})).catch((function(e){return null})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function x(){var e=Object(o.f)(),t=new URLSearchParams(e.search).get("key"),c=new URLSearchParams(e.search).get("language"),a=new URLSearchParams(e.search).get("faceid"),r=Object(n.useState)(!1),i=Object(b.a)(r,2),s=i[0],u=i[1],j=Object(n.useState)(!1),f=Object(b.a)(j,2),x=f[0],g=f[1],w=Object(n.useState)(!1),S=Object(b.a)(w,2),k=S[0],_=S[1],y=Object(n.useState)(!1),I=Object(b.a)(y,2),C=I[0],T=I[1],N=Object(O.a)("common"),E=N.t,R=N.i18n;if(Object(n.useEffect)((function(){R.changeLanguage(null!==c&&void 0!==c?c:"en")}),[]),!a||!t)return Object(h.jsx)("div",{});var L=btoa(atob(t)+"|>*<|aaaaa");return console.log(s,x,k),!s||x||k?Object(h.jsx)("div",{children:Object(h.jsx)(p,{assignmentId:atob(t),callback:function(){return _(!0)},expiredCallback:function(){return u(!0)},faceID:a,submitImage:v,uploadCallback:function(){return T(!0)},passed:x,children:Object(h.jsxs)("div",{children:[Object(h.jsx)("b",{children:E("webcam.view.timer.title")}),Object(h.jsx)("br",{}),Object(h.jsx)(m,{seconds:240,callback:function(){return g(!0)}}),Object(h.jsx)("br",{}),(k||x)&&C?Object(h.jsxs)("div",{children:[E("webcam.view.success.text",{key:L}),Object(h.jsx)("button",{className:"pl-2 underline text-gray-600",onClick:Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.writeText(L);case 2:case"end":return e.stop()}}),e)}))),children:E("webcam.view.success.copy_button")})]}):null]})})}):Object(h.jsx)("div",{children:E("webcam.view.timer.expired")})}var g=function(){return Object(h.jsx)(s.a,{children:Object(h.jsx)(o.c,{children:Object(h.jsxs)(o.a,{path:"/",children:[" ",Object(h.jsx)(x,{})," "]})})})},w=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,57)).then((function(t){var c=t.getCLS,n=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;c(e),n(e),a(e),r(e),i(e)}))},S=c(22),k=c(55),_=c(31),y=c(32);S.a.init({interpolation:{escapeValue:!1},lng:"en",resources:{en:{common:_},ru:{common:y}}}),i.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(k.a,{i18n:S.a,children:Object(h.jsx)(g,{})})}),document.getElementById("root")),w()}},[[54,1,2]]]);
//# sourceMappingURL=main.8dc24fdc.chunk.js.map