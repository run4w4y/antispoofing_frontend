(this.webpackJsonpantispoofing_frontend=this.webpackJsonpantispoofing_frontend||[]).push([[0],{24:function(e,t,c){},35:function(e,t,c){"use strict";c.r(t);var n=c(0),r=c.n(n),a=c(18),i=c.n(a),s=(c(24),c(14)),u=c(2),o=c(4),l=c(17),j=c(8),d=c.n(j),b=c(10),f=c(1),h=function(e){var t=Object(n.useState)(null),c=Object(o.a)(t,2),r=c[0],a=c[1],i=Object(n.useState)(null),s=Object(o.a)(i,2),u=s[0],j=s[1],h=Object(n.useState)(null),O=Object(o.a)(h,2),v=O[0],p=O[1],x=Object(n.useState)(!1),g=Object(o.a)(x,2),m=g[0],k=g[1],S=Object(n.useState)(0),w=Object(o.a)(S,2),y=w[0],I=w[1],T=Object(n.useState)(null),N=Object(o.a)(T,2),C=N[0],D=N[1],E=Object(n.useState)(null),R=Object(o.a)(E,2),M=R[0],P=R[1],W=Object(n.useState)(null),_=Object(o.a)(W,2),F=_[0],J=_[1],L=Object(n.useState)(0),U=Object(o.a)(L,2),B=U[0],H=U[1],q=Object(n.useRef)(null),z=Object(n.useRef)(null),A=Object(n.useRef)(null),G=Object(n.useRef)(null),K=Object(n.useRef)(null),Q=Object(n.useRef)(null),V=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&r.getTracks().forEach((function(e){return e.stop()})),e.t0=a,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:null!==v&&void 0!==v?v:void 0}},audio:!1});case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=5;break}return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,j(t.filter((function(e){return"videoinput"===e.kind})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){X()}),[]),Object(n.useEffect)((function(){V()}),[v]),Object(n.useEffect)((function(){var e;A.current.srcObject=r,null===(e=A.current)||void 0===e||e.play()}),[r]),Object(n.useEffect)((function(){B>=5&&e.callback&&e.callback()}),[B]),Object(n.useEffect)((function(){var t=A.current,c=G.current,n=c.getContext("2d"),r=Q.current.offsetWidth/t.videoWidth,a=function(){var e=K.current,c=e.getContext("2d"),n=600*(t.videoHeight/t.videoWidth);return e.width=600,e.height=n,c.drawImage(t,0,0,600,n),e.toDataURL("image/jpeg",1)};!function(){var e,a;c.width=t.videoWidth*r,c.height=t.videoHeight*r,(null===(e=q.current)||void 0===e?void 0:e.checked)&&n.scale(-1,1),n.drawImage(t,(null===(a=q.current)||void 0===a?void 0:a.checked)?-1*c.width:0,0,c.width,c.height)}(),function(){if(C){var e,t=c.width/600;n.strokeStyle=C.color,n.lineWidth=2,n.rect(C.left*t-((null===(e=q.current)||void 0===e?void 0:e.checked)?c.width:0),C.top*t,(C.right-C.left)*t,(C.bottom-C.top)*t),n.stroke()}}();var i=function(){var t=Object(b.a)(d.a.mark((function t(){var c,n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.submitImage(a(),e.faceID);case 2:c=t.sent,n=c.spoofing<.3&&c.face_score<.7,D(Object(l.a)(Object(l.a)({},c.bbox),{},{color:n?"green":"blue"})),J(c.face_score),P(c.spoofing),n&&H((function(e){return e+1}));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.submitImage&&y%15===0&&i();var s=setTimeout((function(){return I((function(e){return e+1}))}),100);return function(){return clearTimeout(s)}}),[y]),Object(f.jsxs)("div",{children:[Object(f.jsx)("video",{autoPlay:!0,className:"hidden",ref:A,muted:!0}),Object(f.jsxs)("div",{className:"grid grid-cols-2",children:[Object(f.jsx)("div",{ref:Q,className:"col-span-2 lg:col-span-1",children:Object(f.jsx)("canvas",{ref:G})}),Object(f.jsx)("div",{className:"col-span-2 lg:col-span-1 w-50 p-6 bg-gray-100",children:Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"Successful attemps:"})," ",B]}),Object(f.jsx)("li",{children:!F||F>.7?Object(f.jsx)("b",{children:" Not target face "}):Object(f.jsx)("b",{children:" Target face "})}),Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"spoofing:"})," ",M]}),Object(f.jsx)("li",{children:Object(f.jsxs)("label",{children:[Object(f.jsx)("b",{children:"Select input:"}),Object(f.jsx)("br",{}),Object(f.jsx)("select",{ref:z,onChange:function(e){return p(e.target.value)},children:null===u||void 0===u?void 0:u.map((function(e){return Object(f.jsxs)("option",{value:e.deviceId,children:[" ",e.label||"Camera ".concat(e.deviceId)," "]})}))})]})}),Object(f.jsx)("li",{children:Object(f.jsxs)("label",{className:"flex items-center",children:[Object(f.jsx)("b",{className:"pr-2 flex-col",children:"Mirror image:"}),Object(f.jsx)("input",{className:"flex-col",type:"checkbox",ref:q,checked:m,onChange:function(e){k(e.target.checked)}})]})}),Object(f.jsx)("li",{children:e.children})]})})]}),Object(f.jsx)("canvas",{ref:K,className:"hidden"})]})},O=function(e){var t,c=Object(n.useState)(null!==(t=e.seconds)&&void 0!==t?t:120),r=Object(o.a)(c,2),a=r[0],i=r[1];return Object(n.useEffect)((function(){if(!(a<=0)){var t=setTimeout((function(){return i((function(e){return e-1}))}),1e3);return function(){return clearTimeout(t)}}e.callback&&e.callback()}),[a]),Object(f.jsxs)("div",{children:[Object(f.jsxs)("span",{children:[" ",Math.floor(a/60).toString().padStart(2,"0")," "]}),":",Object(f.jsxs)("span",{children:[" ",Math.floor(a%60).toString().padStart(2,"0")," "]})]})},v=function(){var e=Object(b.a)(d.a.mark((function e(t,c){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(",")[1],e.abrupt("return",fetch("https://toloka.suricatvision.com:8443/predictions/biometric",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(JSON.stringify({image:n,id:c}))}).then((function(e){return e.json()})).catch((function(e){return null})));case 2:case"end":return e.stop()}}),e)})));return function(t,c){return e.apply(this,arguments)}}();function p(){var e=Object(u.f)(),t=new URLSearchParams(e.search).get("key"),c=Object(u.g)().faceID,r=Object(n.useState)(!1),a=Object(o.a)(r,2),i=a[0],s=a[1],l=Object(n.useState)(!1),j=Object(o.a)(l,2),d=j[0],b=j[1];return c&&t?i?Object(f.jsx)("div",{children:"Time limit was reached."}):d?Object(f.jsxs)("div",{children:["5 successful attempts were reached, here's your key: ",atob(t+"|>*<|aaaaa")," "]}):Object(f.jsx)("div",{children:Object(f.jsx)(h,{callback:function(){return b(!0)},faceID:c,submitImage:v,children:Object(f.jsxs)("div",{children:[Object(f.jsx)("b",{children:"Time left:"}),Object(f.jsx)("br",{}),Object(f.jsx)(O,{seconds:120,callback:function(){return s(!0)}})]})})}):Object(f.jsx)("div",{})}var x=function(){return Object(f.jsx)(s.a,{basename:"/antispoofing_frontend",children:Object(f.jsx)(u.c,{children:Object(f.jsxs)(u.a,{exact:!0,path:"/:faceID",children:[" ",Object(f.jsx)(p,{})," "]})})})},g=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,36)).then((function(t){var c=t.getCLS,n=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;c(e),n(e),r(e),a(e),i(e)}))};i.a.render(Object(f.jsx)(r.a.StrictMode,{children:Object(f.jsx)(x,{})}),document.getElementById("root")),g()}},[[35,1,2]]]);
//# sourceMappingURL=main.6d70a030.chunk.js.map